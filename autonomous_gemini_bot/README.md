# Автономный ИИ-бот на базе Gemini API (Autonomous Gemini Bot)

Этот проект представляет собой консольного ИИ-бота, созданного на Python с использованием Google Gemini API. 
Бот способен понимать запросы пользователя, генерировать планы для выполнения задач, взаимодействовать 
с файловой системой и выполнять команды терминала.

## Возможности

-   **Взаимодействие на естественном языке:** Бот принимает запросы в свободной форме.
-   **Планирование задач:** Для выполнения сложных запросов бот генерирует пошаговый план с использованием Gemini API.
-   **Взаимодействие с файловой системой:**
    -   Создание, чтение, запись файлов.
    -   Создание директорий.
    -   Просмотр содержимого директорий.
    -   Все операции с файлами ограничены рабочей директорией `workspace/` внутри проекта для безопасности.
-   **Выполнение команд терминала:** Бот может выполнять команды в терминале (с осторожностью и в пределах `workspace/`).
-   **Гибкое выполнение плана:**
    -   Автоматическое выполнение всех шагов.
    -   Пошаговое выполнение с подтверждением каждого шага.
    -   Возможность пропуска отдельных шагов перед или во время пошагового выполнения.
-   **Загрузка системного промпта:** Поведение бота и планировщика инициализируется через системные промпты.

## Архитектура

Проект имеет следующую структуру:

-   `main.py`: Основной файл для запуска бота и главный цикл обработки запросов.
-   `requirements.txt`: Список зависимостей проекта.
-   `prompts/`:
    -   `system_prompt.txt`: Системный промпт для основного клиента Gemini (может использоваться для общих инструкций).
-   `bot_core/`: Ядро бота.
    -   `__init__.py`
    -   `gemini_client.py`: Класс `GeminiClient` для взаимодействия с Google Gemini API. Отвечает за отправку запросов к модели и получение ответов. Загружает API ключ из переменной окружения `GOOGLE_API_KEY`.
    -   `file_system_tools.py`: Модуль с функциями для взаимодействия с файловой системой (`read_file`, `write_to_file`, `create_directory`, `list_directory_contents`, `execute_terminal_command`). Все операции ограничены директорией `workspace/`.
    -   `planner.py`: Класс `Planner`. Использует `GeminiClient` для анализа запроса пользователя и генерации структурированного плана действий в формате JSON. План состоит из шагов, каждый из которых вызывает один из инструментов `file_system_tools.py`. Использует свой системный промпт, включающий описание доступных инструментов.
-   `workspace/`: Рабочая директория бота. Все файлы и директории, создаваемые ботом, будут находиться здесь. Создается автоматически при первом запуске.
-   `tests/`: (Зарезервировано для будущих модульных и интеграционных тестов).

## Настройка и Запуск

1.  **Клонируйте репозиторий (если применимо):**
    ```bash
    # git clone <URL репозитория>
    # cd autonomous_gemini_bot
    ```

2.  **Создайте и активируйте виртуальное окружение (рекомендуется):**
    ```bash
    python3 -m venv venv
    source venv/bin/activate  # для Linux/macOS
    # venv\Scripts\activate    # для Windows
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```
    Основная зависимость - `google-generativeai`.

4.  **Установите API ключ Google Gemini:**
    Бот требует наличия API ключа для Google Gemini. Установите его как переменную окружения:
    ```bash
    export GOOGLE_API_KEY="ВАШ_API_КЛЮЧ"  # для Linux/macOS
    # set GOOGLE_API_KEY="ВАШ_API_КЛЮЧ"    # для Windows (в текущей сессии cmd)
    # $env:GOOGLE_API_KEY="ВАШ_API_КЛЮЧ" # для Windows (в текущей сессии PowerShell)
    ```
    Без этого ключа бот не сможет генерировать планы или отвечать на вопросы с помощью Gemini.

5.  **Запустите бота:**
    ```bash
    python main.py
    ```
    Или, если вы находитесь в корневой директории проекта `autonomous_gemini_bot`:
    ```bash
    python autonomous_gemini_bot/main.py 
    ```
    (Прим.: Worker запускал из `/app/`, поэтому использовал `python3 /app/autonomous_gemini_bot/main.py`)


## Использование

После запуска бота вы увидите приглашение `> `. Введите ваш запрос.

-   **Если это вопрос:** Бот попытается ответить на него напрямую, используя Gemini.
-   **Если это задача:**
    1.  Бот покажет свои "размышления" и сгенерированный план действий.
    2.  Вам будет предложено выбрать режим выполнения плана:
        -   **Автоматический:** Все шаги выполняются последовательно.
        -   **Пошаговый:** Вы можете указать шаги для пропуска, а затем подтверждать или пропускать каждый шаг индивидуально.
        -   **Отменить:** План не будет выполнен.
    3.  Бот будет сообщать о результатах каждого шага. Ошибки на одном из шагов обычно прерывают выполнение всего плана.

**Примеры запросов:**

-   `Привет, что нового?`
-   `Создай файл "plan.txt" в директории "project_docs" с описанием моих планов на выходные.`
-   `Покажи содержимое директории "project_docs".`
-   `Создай папку drafts, затем внутри нее создай файл draft1.txt с текстом "Это черновик", а потом выведи содержимое drafts.`

## Важные замечания по безопасности

-   Функция `execute_terminal_command` позволяет боту выполнять произвольные команды терминала. Хотя она ограничена рабочей директорией `workspace/`, используйте эту возможность с осторожностью. Бот (и LLM, генерирующая планы) должен быть проинструктирован использовать только безопасные команды.
-   Всегда проверяйте планы, сгенерированные ботом, перед их выполнением, особенно если они включают `execute_terminal_command`. Механизм подтверждения и пошагового выполнения предусмотрен для этого.

## Будущие улучшения (TODO)

-   Более надежная обработка ошибок и восстановление.
-   Возможность для бота изменять план "на лету" в зависимости от результатов предыдущих шагов.
-   Поддержка истории диалога для более контекстных взаимодействий.
    -   Интеграция с Gemini API `ChatSession`.
-   Более строгая валидация аргументов функций, генерируемых LLM.
-   Использование полноценного Function Calling API Gemini, когда оно станет более доступным и удобным в SDK, вместо текущей генерации JSON-строки с инструкциями.
-   Добавление полноценных юнит-тестов и интеграционных тестов в директорию `tests/`.
-   Улучшение механизма передачи системных промптов в `GeminiClient` и `Planner`.

```
